<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>index page forum</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>

	<div id="app">

		<nav class="navbar navbar-expand-md bg-dark navbar-dark">
	  		<a class="navbar-brand" href="/">Assassins-Forum</a>

		  	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
		    	<span class="navbar-toggler-icon"></span>
		  	</button>

		  	<div class="collapse navbar-collapse" id="collapsibleNavbar">
		    	<ul class="navbar-nav">
		    		<li class="nav-item"><a class="nav-link" href="/">Main</a></li>
		      		<li class="nav-item"><a class="nav-link" href="/about">About</a></li>
		      		<li class="nav-item"><a class="nav-link" href="/create">Create</a></li>

		    		<li class="nav-item dropdown" v-if="loaded">
	      				<a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown">Все игры</a>
			    		<div class="dropdown-menu bg-dark">
					    	<a class="dropdown-item text-light" v-for="(item, idx) in allGames" :href="item.title">{{ item.title }}</a>
					    </div>
					</li>
		    	</ul>
		  	</div>
		</nav>

		<div class="container-fluid mt-5" v-if="gameData != null">
			<h3 class="text-success ml-5">{{ gameData.title }}</h3>
			<div v-for="(item, idx) in gameData.gameInfo">
				<p class="text-primary">{{ gameData.gameInfo[idx] }}</p>
				<img :src="gameData.gameSrc[idx]">
			</div>
		</div>

	</div>

	<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="create.js"></script>
</body>
</html>

<script>
	
	let app = new Vue({
		el: "#app",
		beforeMount() {
			this.fetchAllGames()
			this.getDataGame()
		},
		data: {
			allGames: [],
			loaded: false,
			gameData: null,
		},
		methods: {
			async fetchAllGames() {
				this.loaded = false
				let response = await fetch('/games', {
					method: "GET",
					headers: {'Content-Type': "application/json"},
				}).then(res => res.json()).then(data => this.allGames = data)

				for (let i = 0; i < this.allGames.length; i++) {
					this.allGames[i]['title'] = `/game/${this.allGames[i]['title']}`
				}
				this.loaded = true
			},
			async getDataGame() {
				let route = "/get" + window.location.pathname
				let response = await fetch(route, {
					method: "GET",
					headers: {'Content-Type' : 'application/json'}
				}).then(res => res.json()).then(data => this.gameData = data)
				console.log(this.gameData)
			}
		}
	})

</script>